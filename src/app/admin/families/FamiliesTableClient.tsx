'use client';import{useState}from'react';import{useRouter}from'next/navigation';interface Family{id:string;slug:string;category:string;name:string;downloads:number;views:number;created_at:Date;description?:string}export default function FamiliesTable({families}:{families:Family[]}){const router=useRouter();const[deleteModal,setDeleteModal]=useState<{show:boolean;family:Family|null}>({show:false,family:null});const[deleting,setDeleting]=useState(false);const[searchQuery,setSearchQuery]=useState('');const[categoryFilter,setCategoryFilter]=useState('all');const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(10);const handleDeleteClick=(family:Family)=>{setDeleteModal({show:true,family})};const handleDeleteConfirm=async()=>{if(!deleteModal.family)return;setDeleting(true);try{const response=await fetch(`/api/admin/families/${deleteModal.family.slug}`,{method:'DELETE'});if(!response.ok){throw new Error('Failed to delete family')}setDeleteModal({show:false,family:null});router.refresh()}catch(error){alert('Error deleting family');setDeleting(false)}};const handleDeleteCancel=()=>{setDeleteModal({show:false,family:null})};const filteredFamilies=families.filter(f=>{const matchesSearch=f.name.toLowerCase().includes(searchQuery.toLowerCase())||f.slug.toLowerCase().includes(searchQuery.toLowerCase())||(f.description||'').toLowerCase().includes(searchQuery.toLowerCase());const matchesCategory=categoryFilter==='all'||f.category===categoryFilter;return matchesSearch&&matchesCategory});const totalPages=Math.ceil(filteredFamilies.length/itemsPerPage);const startIndex=(currentPage-1)*itemsPerPage;const endIndex=startIndex+itemsPerPage;const paginatedFamilies=filteredFamilies.slice(startIndex,endIndex);const handlePageChange=(page:number)=>{setCurrentPage(page);window.scrollTo({top:0,behavior:'smooth'})};const handleItemsPerPageChange=(value:number)=>{setItemsPerPage(value);setCurrentPage(1)};const handleSearchOrFilter=()=>{setCurrentPage(1)};return(<div><div className="flex items-center justify-between mb-8"><div><h1 className="text-3xl font-bold text-gray-900">Manage Families</h1><p className="text-gray-600 mt-1">Showing {startIndex+1}-{Math.min(endIndex,filteredFamilies.length)} of {filteredFamilies.length} families</p></div><a href="/admin/families/new" className="inline-flex items-center px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-medium transition">+ Add New Family</a></div><div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4"><div className="flex items-center gap-4"><div className="flex-1"><input type="text" placeholder="Search by name, slug, or description..." value={searchQuery} onChange={(e)=>{setSearchQuery(e.target.value);handleSearchOrFilter()}} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/></div><div className="w-48"><select value={categoryFilter} onChange={(e)=>{setCategoryFilter(e.target.value);handleSearchOrFilter()}} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"><option value="all">All Categories</option><option value="furniture">Furniture</option><option value="doors">Doors</option><option value="windows">Windows</option><option value="lighting">Lighting</option></select></div>{(searchQuery||categoryFilter!=='all')&&<button onClick={()=>{setSearchQuery('');setCategoryFilter('all');handleSearchOrFilter()}} className="px-4 py-2 text-gray-600 hover:text-gray-900 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Clear</button>}</div></div><div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Downloads</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Views</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{paginatedFamilies.length===0?<tr><td colSpan={6} className="px-6 py-12 text-center text-gray-500">{searchQuery||categoryFilter!=='all'?'No families match your search criteria.':'No families found.'}</td></tr>:paginatedFamilies.map(f=><tr key={f.id} className="hover:bg-gray-50"><td className="px-6 py-4 whitespace-nowrap"><div className="text-sm font-medium text-gray-900">{f.name}</div><div className="text-sm text-gray-500">{f.slug}</div></td><td className="px-6 py-4 whitespace-nowrap"><span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800 capitalize">{f.category}</span></td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{f.downloads.toLocaleString()}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{f.views.toLocaleString()}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(f.created_at).toLocaleDateString()}</td><td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><div className="flex items-center justify-end space-x-3"><a href={`/revit/${f.category}/${f.slug}`} target="_blank" rel="noopener noreferrer" className="text-orange-600 hover:text-orange-900">View</a><a href={`/admin/families/edit?slug=${f.slug}`} className="text-green-600 hover:text-green-900">Edit</a><button onClick={()=>handleDeleteClick(f)} className="text-red-600 hover:text-red-900">Delete</button></div></td></tr>)}</tbody></table></div>{filteredFamilies.length>0&&<div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mt-4"><div className="flex items-center justify-between"><div className="flex items-center gap-4"><span className="text-sm text-gray-700">Show</span><select value={itemsPerPage} onChange={(e)=>handleItemsPerPageChange(Number(e.target.value))} className="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent"><option value={5}>5</option><option value={10}>10</option><option value={25}>25</option><option value={50}>50</option></select><span className="text-sm text-gray-700">per page</span></div><div className="flex items-center gap-2"><button onClick={()=>handlePageChange(currentPage-1)} disabled={currentPage===1} className="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition">Previous</button><div className="flex items-center gap-1">{Array.from({length:totalPages},(_,i)=>i+1).map(page=><button key={page} onClick={()=>handlePageChange(page)} className={`px-3 py-1 text-sm font-medium rounded-lg transition ${page===currentPage?'bg-orange-500 text-white':'text-gray-700 hover:bg-gray-100'}`}>{page}</button>)}</div><button onClick={()=>handlePageChange(currentPage+1)} disabled={currentPage===totalPages} className="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition">Next</button></div></div></div>}{deleteModal.show&&deleteModal.family&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div className="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4"><h3 className="text-xl font-bold text-gray-900 mb-2">Delete Family</h3><p className="text-gray-600 mb-6">Are you sure you want to delete <span className="font-semibold">{deleteModal.family.name}</span>? This action cannot be undone.</p><div className="flex items-center justify-end space-x-3"><button onClick={handleDeleteCancel} disabled={deleting} className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Cancel</button><button onClick={handleDeleteConfirm} disabled={deleting} className="px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-lg transition font-medium">{deleting?'Deleting...':'Delete'}</button></div></div></div>}</div>)}